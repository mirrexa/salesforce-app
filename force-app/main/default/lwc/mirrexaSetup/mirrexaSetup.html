<template>
  <lightning-card title="Mirrexa Connection Setup" icon-name="custom:custom14">
    <div class="slds-var-m-around_medium">
      <!-- Connection Status Component -->
      <c-mirrexa-connection-status
        auto-register="true"
        check-on-connect="true"
        show-loading-spinner="false"
        onconnectionstatuschange={handleConnectionStatusChange}
        onconnectionerror={handleConnectionError}
        onuserregistered={handleUserRegistered}
      ></c-mirrexa-connection-status>

      <template if:false={isNamedCredentialConnected}>
        <template if:false={isUserCredentialConnected}>
          <p class="slds-var-m-bottom_medium">
            To connect your Salesforce org to Mirrexa, click the button below.
            This will open a popup asking you to log in to your Mirrexa account
            to authorize the connection.
          </p>
          <lightning-button
            label="Connect to Mirrexa using this first"
            variant="brand"
            onclick={handleConnectClick}
          >
          </lightning-button>
        </template>
      </template>

      <template if:true={isNamedCredentialConnected}>
        <p
          class="slds-var-m-top_medium slds-text-heading_medium slds-text-color_success"
        >
          Connection Successful!
        </p>
        <p>{statusMessage}</p>
        <p>
          <strong>
            You will now need to press the "Connect to Mirrexa" button to
            complete the connection.</strong
          >
        </p>
        <p>The first button-click connected your Organization to Mirrexa.</p>
        <p>The second button will connect your User to Mirrexa.</p>
      </template>

      <template if:true={isUserCredentialConnected}>
        <p class="slds-text-heading_medium slds-text-color_success">
          Connection Successful!
        </p>
        <p>
          Your org is now connected to Mirrexa. You can start creating
          documents.
        </p>
      </template>

      <!-- Status and Error Messages -->
      <div class="slds-var-m-top_medium">
        <template if:true={errorMessage}>
          <p class="slds-text-color_error">{errorMessage}</p>
        </template>
      </div>
    </div>
  </lightning-card>
</template>
